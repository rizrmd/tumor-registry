(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{1149:function(e,t,a){Promise.resolve().then(a.t.bind(a,3649,23)),Promise.resolve().then(a.t.bind(a,3385,23)),Promise.resolve().then(a.bind(a,2888)),Promise.resolve().then(a.bind(a,6986)),Promise.resolve().then(a.bind(a,7301)),Promise.resolve().then(a.bind(a,9780))},2888:function(e,t,a){"use strict";a.r(t),a.d(t,{UpdateNotification:function(){return s},useUpdateNotification:function(){return i}});var n=a(7437),r=a(2265),l=a(7593);function s(e){let{onDownloadUpdate:t,onDismiss:a}=e,{CheckForUpdates:s,GetCachedUpdateInfo:i,GetAppVersion:c,PerformUpdate:o}=(0,l.p)(),[u,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(""),[f,p]=(0,r.useState)(!1),[x,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)("confirmation"),[w,v]=(0,r.useState)(0),[j,k]=(0,r.useState)(""),[N,C]=(0,r.useState)(""),[S,F]=(0,r.useState)(!0),[L,U]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await c();if(!e)return;t&&"web"!==t&&h(t);let a=await i();if(!e)return;(null==a?void 0:a.updateAvailable)&&(d(a),p(!0))}catch(t){if(!e)return;console.log("[UpdateNotification] Update check skipped (not in desktop mode or error)")}})(),()=>{e=!1}},[c,i]);let P=async()=>{b("backing-up"),v(0),U("");try{await (null==o?void 0:o(u.downloadUrl,S,e=>{if(k(e),e.includes("Backup"))b("backing-up"),v(25);else if(e.includes("Downloading"))b("downloading"),v(50);else if(e.includes("%")){let t=e.match(/(\d+\.?\d*)%/);if(t){let e=parseFloat(t[1]);"downloading"===y&&v(50+e/2)}}else e.includes("Installing")?(b("installing"),v(75)):e.includes("complete")&&(b("complete"),v(100))})),b("complete")}catch(e){console.error("Update failed:",e),U((null==e?void 0:e.message)||"Update failed"),b("error")}},E=()=>{(null==u?void 0:u.mandatory)||p(!1),null==a||a()},A=()=>{"complete"===y&&p(!1),E()};return f&&u?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden",children:[(0,n.jsx)("div",{className:"px-6 py-4 ".concat("error"===y?"bg-red-500":"complete"===y?"bg-emerald-500":u.mandatory?"bg-red-500":"bg-emerald-500"),children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-white font-semibold text-lg",children:"error"===y?"Update Failed":"complete"===y?"Update Complete":"confirmation"===y?u.mandatory?"Mandatory Update Required":"New Update Available":"Updating..."}),("confirmation"===y||"complete"===y)&&!u.mandatory&&(0,n.jsx)("button",{onClick:A,className:"text-white/80 hover:text-white transition-colors",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,n.jsxs)("div",{className:"p-6",children:["confirmation"===y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-gray-700 mb-4",children:u.mandatory?"A mandatory update is available. Version ".concat(u.latestVersion," includes important security and stability fixes."):"A new version (".concat(u.latestVersion,") is available! You're currently running ").concat(m||u.currentVersion,".")}),u.changelog&&u.changelog.length>0&&(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"What's New:"}),(0,n.jsx)("ul",{className:"text-sm text-gray-600 space-y-1",children:u.changelog.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-start",children:[(0,n.jsx)("span",{className:"text-emerald-500 mr-2",children:"â€¢"}),(0,n.jsx)("span",{children:e})]},t))})]}),u.releaseDate&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mb-4",children:["Released: ",new Date(u.releaseDate).toLocaleDateString()]}),(0,n.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,n.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,n.jsx)("input",{type:"checkbox",checked:S,onChange:e=>F(e.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Create backup before updating"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Recommended - backs up your database and files"})]})]})}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsxs)("button",{onClick:P,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all shadow-sm ".concat(u.mandatory?"bg-red-600 text-white hover:bg-red-700 active:scale-[0.98]":"bg-emerald-600 text-white hover:bg-emerald-700 active:scale-[0.98]"),children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,n.jsx)("span",{children:"Update Now"})]}),!u.mandatory&&(0,n.jsx)("button",{onClick:E,className:"px-4 py-2.5 rounded-lg text-sm font-semibold text-gray-700 hover:bg-gray-100 transition-colors",children:"Later"})]})]}),("backing-up"===y||"downloading"===y||"installing"===y)&&(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:(0,n.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 bg-blue-500",style:{width:"".concat(w,"%")}})}),(0,n.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center text-sm ".concat("backing-up"===y?"text-blue-600 font-semibold":"text-gray-500"),children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat("backing-up"===y?"bg-blue-500":"bg-gray-300")}),"Backing up data"]}),(0,n.jsxs)("div",{className:"flex items-center justify-center text-sm ".concat("downloading"===y?"text-blue-600 font-semibold":"text-gray-500"),children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat("downloading"===y?"bg-blue-500 animate-pulse":"bg-gray-300")}),"Downloading update"]}),(0,n.jsxs)("div",{className:"flex items-center justify-center text-sm ".concat("installing"===y?"text-blue-600 font-semibold":"text-gray-500"),children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat("installing"===y?"bg-blue-500 animate-pulse":"bg-gray-300")}),"Installing update"]})]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:j})]}),"complete"===y&&(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,n.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Update Complete!"}),(0,n.jsxs)("p",{className:"text-gray-600 mb-4",children:["The application has been updated to version ",u.latestVersion,".",N&&" Your data was backed up before the update."]}),(0,n.jsx)("button",{onClick:A,className:"px-6 py-2.5 bg-emerald-600 text-white rounded-lg font-semibold hover:bg-emerald-700 transition-colors",children:"Continue"})]}),"error"===y&&(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,n.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Update Failed"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:L}),(0,n.jsxs)("div",{className:"flex space-x-3 justify-center",children:[(0,n.jsx)("button",{onClick:P,className:"px-6 py-2.5 bg-emerald-600 text-white rounded-lg font-semibold hover:bg-emerald-700 transition-colors",children:"Try Again"}),(0,n.jsx)("button",{onClick:E,className:"px-6 py-2.5 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})]})}):null}function i(){let[e,t]=(0,r.useState)(!1);return{UpdateNotification:s,ManualCheckButton:()=>{let{CheckForUpdates:e}=(0,l.p)(),[a,s]=(0,r.useState)(!1),i=async()=>{s(!0);try{await (null==e?void 0:e()),t(!0)}catch(e){console.error("Failed to check for updates:",e)}finally{s(!1)}};return(0,n.jsx)("button",{onClick:i,disabled:a,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-emerald-600 rounded-full animate-spin"}),(0,n.jsx)("span",{children:"Checking..."})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,n.jsx)("span",{children:"Check for Updates"})]})})},showManualCheck:e,setShowManualCheck:t}}},7301:function(e,t,a){"use strict";a.r(t),a.d(t,{SyncProvider:function(){return o},useSync:function(){return u}});var n=a(7437),r=a(2265),l=a(7841),s=a(6986);let i=(0,r.createContext)(void 0),c={phase:"idle",phaseProgress:0,dataPushed:0,dataPulled:0,filesSynced:0,totalFiles:0};function o(e){let{children:t}=e,{user:a}=(0,s.useAuth)(),[o,u]=(0,r.useState)(null),[d,m]=(0,r.useState)(null),[h,f]=(0,r.useState)(!1),[p,x]=(0,r.useState)(c),[g,y]=(0,r.useState)(null),[b,w]=(0,r.useState)(null),v=(0,r.useRef)(null),j=(0,r.useRef)(null),k=(0,r.useCallback)(async()=>{if(a)try{let e=await l.Rb.getStatistics();u(e),w(null),e.processing>0?f(!0):h&&0===e.processing&&(f(!1),y(new Date))}catch(e){console.error("Failed to fetch sync statistics:",e),w(e.message||"Failed to fetch sync status")}},[a,h]),N=(0,r.useCallback)(async()=>{if(a)try{let e=await l.Rb.getFullSyncStatus();m(e)}catch(e){console.error("Failed to fetch full sync status:",e)}},[a]),C=async()=>{if(!h){f(!0),w(null);try{await l.Rb.syncAll(),await k(),y(new Date)}catch(e){console.error("Manual sync failed:",e),w(e.message||"Manual sync failed")}finally{f(!1)}}},S=async()=>{if(!h){f(!0),w(null),x({...c,phase:"push"});try{j.current=setInterval(async()=>{await N()},1e3),await l.Rb.runFullSync(),x({...c,phase:"complete"}),await k(),await N(),y(new Date)}catch(e){console.error("Full sync failed:",e),w(e.message||"Full sync failed"),x({...c,phase:"error"})}finally{f(!1),j.current&&(clearInterval(j.current),j.current=null)}}};return(0,r.useEffect)(()=>{if(!d||!h)return;let{dataSync:e,fileSync:t,isOnline:a}=d,n="idle";a?e.processing>0?n="push":t.inProgress>0||t.pending>0?n="files":0===e.pending&&0===t.pending&&(n="complete"):n="error",x(a=>({...a,phase:n,dataPushed:e.synced,dataPulled:e.synced,filesSynced:t.completed,totalFiles:t.completed+t.pending+t.inProgress,currentFile:t.currentFile,phaseProgress:t.currentProgress||0}))},[d,h]),(0,r.useEffect)(()=>(a?(k(),N(),v.current=setInterval(()=>{k(),N()},3e4)):(v.current&&(clearInterval(v.current),v.current=null),u(null),m(null)),()=>{v.current&&clearInterval(v.current),j.current&&clearInterval(j.current)}),[a,k,N]),(0,n.jsx)(i.Provider,{value:{statistics:o,fullSyncStatus:d,isSyncing:h,syncProgress:p,lastSyncedAt:g,error:b,triggerSync:C,triggerFullSync:S,refreshStatistics:k},children:t})}function u(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useSync must be used within a SyncProvider");return e}},7593:function(e,t,a){"use strict";a.d(t,{p:function(){return l}});var n=a(2265);function r(){var e,t;return(null===(t=window.go)||void 0===t?void 0:null===(e=t.main)||void 0===e?void 0:e.App)||window.wails||null}function l(){let[e,t]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>!!r()&&(t(!0),!0);if(e())return;let a=0,n=setInterval(()=>{a++,(e()||a>=50)&&(clearInterval(n),a>=50&&console.log("[useWails] Running in web mode (Wails not detected)"))},100);return()=>clearInterval(n)},[]);let a=(0,n.useCallback)(async()=>{let e=r();if(!e)return"web";try{return await e.GetAppVersion()}catch(e){return console.error("Failed to get app version:",e),"web"}},[]),l=(0,n.useCallback)(async()=>{let e=r();if(!e)return null;try{return await e.CheckForUpdates()}catch(e){return console.error("Failed to check for updates:",e),null}},[]),s=(0,n.useCallback)(async()=>{let e=r();if(!e)return null;try{return await e.GetCachedUpdateInfo()}catch(e){return console.error("Failed to get cached update info:",e),null}},[]),i=(0,n.useCallback)(async()=>{let e=r();if(!e)return null;try{return await e.CreateBackup()}catch(e){throw console.error("Failed to create backup:",e),e}},[]),c=(0,n.useCallback)(async()=>{let e=r();if(!e)return null;try{return await e.ListBackups()}catch(e){return console.error("Failed to list backups:",e),null}},[]),o=(0,n.useCallback)(async e=>{let t=r();if(t)try{await t.RestoreBackup(e)}catch(e){throw console.error("Failed to restore backup:",e),e}},[]),u=(0,n.useCallback)(async e=>{let t=r();if(t)try{await t.DeleteBackup(e)}catch(e){throw console.error("Failed to delete backup:",e),e}},[]),d=(0,n.useCallback)(async(e,t,a)=>{let n=r();if(n)try{await n.PerformUpdate(e,t,a)}catch(e){throw console.error("Failed to perform update:",e),e}},[]),m=(0,n.useCallback)(async(e,t)=>{let a=r();if(a)try{await a.ImportDataFromPath(e,t)}catch(e){throw console.error("Failed to import data:",e),e}},[]),h=(0,n.useCallback)(async(e,t)=>{let a=r();if(!a)return null;try{return await a.Login(e,t)}catch(e){return console.error("Login failed:",e),null}},[]);return{isWailsAvailable:e,GetAppVersion:a,CheckForUpdates:l,GetCachedUpdateInfo:s,CreateBackup:i,ListBackups:c,RestoreBackup:o,DeleteBackup:u,PerformUpdate:d,ImportDataFromPath:m,Login:h,Logout:(0,n.useCallback)(async()=>{let e=r();if(e)try{await e.Logout()}catch(e){console.error("Logout failed:",e)}},[]),GetAuthStatus:(0,n.useCallback)(async()=>{let e=r();if(!e)return null;try{return await e.GetAuthStatus()}catch(e){return console.error("Failed to get auth status:",e),null}},[]),GetCentralServerUrl:(0,n.useCallback)(async()=>{let e=r();if(!e)return"";try{return await e.GetCentralServerUrl()}catch(e){return console.error("Failed to get central server URL:",e),""}},[])}}},9780:function(e,t,a){"use strict";a.r(t),a.d(t,{QueryProvider:function(){return c}});var n=a(7437),r=a(8044),l=a(8038),s=a(521),i=a(2265);function c(e){let{children:t}=e,[a]=(0,i.useState)(()=>new r.S({defaultOptions:{queries:{staleTime:6e4,gcTime:3e5,retry:1,refetchOnWindowFocus:!1}}}));return(0,n.jsxs)(l.aH,{client:a,children:[t,(0,n.jsx)(s.t,{initialIsOpen:!1})]})}},7841:function(e,t,a){"use strict";a.d(t,{Rb:function(){return s},Wp:function(){return r}});var n,r,l=a(6383);(n=r||(r={})).USE_LOCAL="USE_LOCAL",n.USE_REMOTE="USE_REMOTE",n.MERGE="MERGE",n.MANUAL="MANUAL";let s={getStatistics:async()=>(await l.Z.get("/offline-queue/statistics")).data,getQueueItems:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(await l.Z.get("/offline-queue/pending",{params:{limit:e}})).data},resolveConflict:async(e,t,a)=>(await l.Z.put("/offline-queue/".concat(e,"/resolve-conflict"),{resolution:t,mergedData:a})).data,retryItem:async e=>(await l.Z.put("/offline-queue/".concat(e,"/retry"))).data,syncAll:async()=>(await l.Z.post("/offline-queue/sync-all")).data,runFullSync:async()=>(await l.Z.post("/offline-queue/full-sync")).data,getFullSyncStatus:async()=>(await l.Z.get("/offline-queue/full-sync-status")).data,getFileSyncStatus:async()=>(await l.Z.get("/offline-queue/files/status")).data,syncFiles:async()=>(await l.Z.post("/offline-queue/files/sync")).data,getPendingFiles:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(await l.Z.get("/offline-queue/files/pending",{params:{limit:e}})).data}}},3385:function(){}},function(e){e.O(0,[4829,4417,5616,1956,2971,4938,1744],function(){return e(e.s=1149)}),_N_E=e.O()}]);