(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4109],{3528:function(e,a,t){Promise.resolve().then(t.bind(t,7500))},7500:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return C}});var s=t(7437),r=t(2265),l=t(7372),d=t(6986),n=t(4033),o=t(2482),i=e=>{let{filters:a,onChange:t,onSearch:r,loading:l}=e,d=(e,s)=>{let r={...a};""===s||void 0===s?delete r[e]:r[e]=s,t(r)};return(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 text-gray-500"}),(0,s.jsx)("h3",{className:"font-semibold text-gray-700",children:"Filter Data Analytics"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Province"}),(0,s.jsxs)("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",value:a.province||"",onChange:e=>d("province",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"All Provinces"}),(0,s.jsx)("option",{value:"Jawa Timur",children:"Jawa Timur"}),(0,s.jsx)("option",{value:"DKI Jakarta",children:"DKI Jakarta"}),(0,s.jsx)("option",{value:"Jawa Barat",children:"Jawa Barat"}),(0,s.jsx)("option",{value:"Jawa Tengah",children:"Jawa Tengah"}),(0,s.jsx)("option",{value:"DI Yogyakarta",children:"DI Yogyakarta"}),(0,s.jsx)("option",{value:"Bali",children:"Bali"}),(0,s.jsx)("option",{value:"Sulawesi Selatan",children:"Sulawesi Selatan"}),(0,s.jsx)("option",{value:"Sumatera Utara",children:"Sumatera Utara"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City/Regency"}),(0,s.jsx)("input",{type:"text",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",value:a.regency||"",onChange:e=>d("regency",e.target.value),placeholder:"e.g. Surabaya"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cancer Stage"}),(0,s.jsxs)("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",value:a.cancerStage||"",onChange:e=>d("cancerStage",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"All Stages"}),(0,s.jsx)("option",{value:"I",children:"Stage I"}),(0,s.jsx)("option",{value:"II",children:"Stage II"}),(0,s.jsx)("option",{value:"III",children:"Stage III"}),(0,s.jsx)("option",{value:"IV",children:"Stage IV"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),(0,s.jsxs)("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",value:a.gender||"",onChange:e=>d("gender",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"All Genders"}),(0,s.jsx)("option",{value:"male",children:"Male"}),(0,s.jsx)("option",{value:"female",children:"Female"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"date",className:"w-full rounded-md border-gray-300 shadow-sm p-2 border text-xs",value:a.startDate||"",onChange:e=>d("startDate",e.target.value),placeholder:"Start"}),(0,s.jsx)("input",{type:"date",className:"w-full rounded-md border-gray-300 shadow-sm p-2 border text-xs",value:a.endDate||"",onChange:e=>d("endDate",e.target.value),placeholder:"End"})]})]})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsx)("button",{onClick:r,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-300 font-medium text-sm flex items-center",children:l?"Applying Filters...":"Apply Filters"})})]})},c=t(5817),x=e=>{let{onExport:a,loading:t}=e;return(0,s.jsxs)("button",{onClick:a,disabled:t,className:"flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,s.jsx)(c.Z,{className:"mr-2 h-4 w-4 text-gray-500"}),t?"Exporting...":"Export Data (CSV)"]})},b=t(6704),g=t(105);b.kL.register(b.uw,b.f$,b.ZL,b.Dx,b.u,b.De,b.qi);let h=e=>{let{data:a}=e,t={labels:Object.keys(a).map(e=>e.charAt(0).toUpperCase()+e.slice(1)),datasets:[{data:Object.values(a),backgroundColor:["rgba(54, 162, 235, 0.6)","rgba(255, 99, 132, 0.6)","rgba(255, 206, 86, 0.6)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(255, 206, 86, 1)"],borderWidth:1}]};return(0,s.jsx)(g.by,{data:t,options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})},m=e=>{let{data:a}=e,t={labels:Object.keys(a),datasets:[{label:"Patients",data:Object.values(a),backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]};return(0,s.jsx)(g.$Q,{data:t,options:{responsive:!0,plugins:{legend:{display:!1}}}})},u=e=>{let{data:a}=e,t=Object.entries(a).sort((e,a)=>a[1]-e[1]).slice(0,10),r={labels:t.map(e=>e[0].replace(/_/g," ")),datasets:[{label:"Patients",data:t.map(e=>e[1]),backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]};return(0,s.jsx)(g.$Q,{data:r,options:{indexAxis:"y",responsive:!0,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0}}}})};var p=t(6383);class j{async getStatistics(){return(await p.Z.get("/national-dashboard/statistics")).data}async searchAggregated(e){return(await p.Z.post("/national-dashboard/search-aggregated",e)).data}async downloadExport(e){let a=await p.Z.post("/national-dashboard/export",e,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a");s.href=t,s.setAttribute("download","analytics_export_".concat(new Date().toISOString().split("T")[0],".csv")),document.body.appendChild(s),s.click(),s.remove()}}let y=new j;var v=t(5750),f=t(2812),w=t(3733),N=t(998),k=t(4930);let S=t.n(k)()(()=>Promise.all([t.e(4212),t.e(3195)]).then(t.bind(t,3195)),{loadableGenerated:{webpack:()=>[3195]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"h-96 w-full bg-gray-100 animate-pulse rounded-lg"})});function C(){let{user:e,isLoading:a}=(0,d.useAuth)(),t=(0,n.useRouter)(),[o,c]=(0,r.useState)(null),[b,g]=(0,r.useState)(null),[p,j]=(0,r.useState)({}),[k,C]=(0,r.useState)(!0),[I,P]=(0,r.useState)(!1),[A,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{a||e||t.push("/login")},[e,a,t]),(0,r.useEffect)(()=>{let a=async()=>{try{C(!0);let[e,a]=await Promise.all([y.getStatistics(),y.searchAggregated({})]);c(e),g(a)}catch(e){console.error("Data load error:",e),O("Failed to load dashboard data.")}finally{C(!1)}};e&&a()},[e]);let E=async()=>{try{C(!0);let e=await y.searchAggregated(p);g(e)}catch(e){console.error("Search error:",e),O("Failed to filter data.")}finally{C(!1)}},T=async()=>{try{P(!0),await y.downloadExport(p)}catch(e){console.error("Export error:",e),alert("Failed to export data")}finally{P(!1)}};return a||k&&!o?(0,s.jsx)(l.A,{children:(0,s.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):(0,s.jsx)(l.A,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"National Dashboard"}),(0,s.jsx)("p",{className:"text-gray-500 mt-1",children:"Comprehensive analysis of musculoskeletal tumor cases across Indonesia."})]}),(0,s.jsx)("div",{className:"mt-4 md:mt-0",children:(0,s.jsx)(x,{onExport:T,loading:I})})]}),(0,s.jsx)(i,{filters:p,onChange:j,onSearch:E,loading:k}),A&&(0,s.jsx)("div",{className:"bg-red-50 text-red-700 p-4 rounded-md mb-6 border border-red-200",children:A}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)(D,{title:"Total Matching Patients",value:(null==b?void 0:b.totalMatches)||0,icon:(0,s.jsx)(v.Z,{className:"h-6 w-6 text-blue-600"}),subtext:"Based on current filters"}),(0,s.jsx)(D,{title:"Total Active Centers",value:(null==o?void 0:o.totalCenters)||0,icon:(0,s.jsx)(f.Z,{className:"h-6 w-6 text-green-600"}),subtext:"Nationwide"}),(0,s.jsx)(D,{title:"Provinces Covered",value:Object.keys((null==o?void 0:o.byProvince)||{}).length,icon:(0,s.jsx)(w.Z,{className:"h-6 w-6 text-purple-600"}),subtext:"Nationwide"}),(0,s.jsx)(D,{title:"Last Updated",value:new Date().toLocaleDateString(),icon:(0,s.jsx)(N.Z,{className:"h-6 w-6 text-orange-600"}),subtext:"Daily aggregate"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 bg-white p-6 rounded-lg shadow border border-gray-200",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Geographic Distribution"}),(0,s.jsx)(S,{data:(null==b?void 0:b.breakdown.byProvince)||{}})]}),(0,s.jsxs)("div",{className:"lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700 mb-4",children:"Top Provinces"}),(0,s.jsx)("div",{className:"overflow-auto max-h-64",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"Province"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right",children:"Patients"})]})}),(0,s.jsxs)("tbody",{children:[Object.entries((null==b?void 0:b.breakdown.byProvince)||{}).sort((e,a)=>{let[,t]=e,[,s]=a;return s-t}).map(e=>{let[a,t]=e;return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"px-4 py-2",children:a}),(0,s.jsx)("td",{className:"px-4 py-2 text-right font-medium",children:t})]},a)}),0===Object.keys((null==b?void 0:b.breakdown.byProvince)||{}).length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:2,className:"px-4 py-4 text-center text-gray-400",children:"No data"})})]})]})})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700 mb-4",children:"Top Cities/Regencies"}),(0,s.jsx)("div",{className:"overflow-auto max-h-64",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left",children:"City/Regency"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right",children:"Patients"})]})}),(0,s.jsxs)("tbody",{children:[Object.entries((null==b?void 0:b.breakdown.byRegency)||{}).sort((e,a)=>{let[,t]=e,[,s]=a;return s-t}).slice(0,10).map(e=>{let[a,t]=e;return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"px-4 py-2",children:"undefined"===a||"null"===a?"Unknown":a}),(0,s.jsx)("td",{className:"px-4 py-2 text-right font-medium",children:t})]},a)}),0===Object.keys((null==b?void 0:b.breakdown.byRegency)||{}).length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:2,className:"px-4 py-4 text-center text-gray-400",children:"No data"})})]})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"Gender Distribution"}),(0,s.jsx)(h,{data:(null==b?void 0:b.breakdown.byGender)||{}})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"Cancer Stage"}),(0,s.jsx)(m,{data:(null==b?void 0:b.breakdown.byStage)||{}})]})]})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200 mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Top Pathology Types"}),(0,s.jsx)("div",{className:"h-96",children:(0,s.jsx)(u,{data:(null==b?void 0:b.breakdown.byPathology)||{}})})]})]})})}let D=e=>{let{title:a,value:t,icon:r,subtext:l}=e;return(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200 flex flex-col justify-between",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500",children:a}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mt-1",children:"number"==typeof t?t.toLocaleString():t})]}),(0,s.jsx)("div",{className:"p-2 bg-gray-50 rounded-lg",children:r})]}),l&&(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:l})]})}}},function(e){e.O(0,[7674,4737,1529,1956,7372,2971,4938,1744],function(){return e(e.s=3528)}),_N_E=e.O()}]);